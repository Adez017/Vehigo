<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="../assets/images/Vehigo.svg" type="image/svg+xml" />

    <title>Vehigo - Rent your favourite car</title>

    <link rel="stylesheet" href="../assets/styles/loginstyle.css" />
    <link rel="stylesheet" href="../assets/styles/style.css" />

    <link
      href="https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css"
      rel="stylesheet"
    />
  </head>


<div id="spinnerOverlay" style="display: none;">
    <span class="loader"></span>
</div>

  <body>
    <header class="header" data-header>
      <div class="container" style="background-color: #0171d3">
        <!-- <div class="overlay" data-overlay></div> -->

        <a href="../../index.html" class="logo">
          <img src="../assets/images/vehigologo.png" alt="VehiGo logo" />
        </a>

        <nav class="navbar" data-navbar>
          <ul class="navbar-list">
            <li>
              <a href="../../index.html" class="navbar-link" data-nav-link>Home</a>
            </li>

            <li>
              <a
                href="../../featured-car.html"
                class="navbar-link"
                data-nav-link
                >Explore cars</a
              >
            </li>

            <li>
              <a href="./about.html" class="navbar-link" data-nav-link
                >About us</a
              >
            </li>

            <li>
              <a href="../../blog.html" class="navbar-link" data-nav-link
                >Blog</a
              >
            </li>
          </ul>
        </nav>

        <div class="header-actions">
          <div class="header-contact">
            <a href="tel:1800100100" class="contact-link" style="text-decoration: none;color:white">1800-100-100</a>

            <span class="contact-time" style="color: white;">Mon - Sat: 9:00 am - 6:00 pm</span>
          </div>
        </div>
      </div>
    </header>




    <div class="body_tag">
      <section class="container forms">
        <div class="form login">
              <div class="message">
  <h1 class="title">ðŸ‘‹ Hey there!!</h1>
  <p class="subtitle">Welcome to <span class="brand">VehiGo</span></p>
</div>
          <div class="form-content">
            <header>Login</header>
            <form id="loginForm" action="/login" method="POST">
              <div class="field input-field">
                <input
                  id="email"
                  name="email"
                  type="email"
                  placeholder="Email"
                  class="input"
                  required
                />
              </div>

              <div class="field input-field">
                <input
                  id="password"
                  name="password"
                  type="password"
                  placeholder="Password"
                  class="password"
                  required
                />
                <i class="bx bx-hide eye-icon"></i>
              </div>
              <div class="form-link">
                <a href="./forgot-password.html" class="forgot-pass"
                  >Forgot password?</a
                >
              </div>

              <div class="field button-field">
                <button type="submit">Login</button>
              </div>
            </form>

            <div class="form-link">
              <span
                >Don't have an account?
                <a href="#" class="link signup-link">Signup</a></span
              >
            </div>
          </div>

          <div id="loginMessage"></div>
        </div>

        <div class="form signup">
          <div class="form-content">
            <header>Signup</header>
            <form id="signupForm" action="/signup" method="POST">
              <div class="field input-field">
                <input
                  id="name"
                  name="name"
                  type="text"
                  placeholder="Your Name"
                  class="name"
                  required
                />
              </div>

              <div class="field input-field">
                <input
                  id="signupEmail"
                  name="email"
                  type="email"
                  placeholder="Email"
                  class="email"
                  required
                  autocomplete="off"
                />
              </div>

              <div class="field input-field">
                <input
                  id="signupPassword"
                  name="password"
                  type="password"
                  placeholder="password"
                  class="password"
                  required
                />
                <i class="bx bx-hide eye-icon"></i>
              </div>
              <ul id="passwordChecklist" class="password-checklist">
              <li id="check-length" class="invalid">âœ” At least 8 characters</li>
              <li id="check-uppercase" class="invalid">âœ” At least one uppercase letter</li>
              <li id="check-lowercase" class="invalid">âœ” At least one lowercase letter</li>
              <li id="check-number" class="invalid">âœ” At least one number</li>
              <li id="check-special" class="invalid">âœ” At least one special character (!@#$%^&*)</li>
              </ul>
              <div class="field input-field">
                <input
                  id="confirmPassword"
                  name="confirm_password"
                  type="password"  
                  placeholder="Confirm password"
                  class="password"
                  required
                />
                <i class="bx bx-hide eye-icon"></i>
              </div>

              <div class="field input-field">
                <input
                  id="phone_number"
                  name="number"
                  type="text"
                  placeholder="Your Phone Number"
                  class="ph-number"
                  required
                />
              </div>

              <div class="field input-field">
                <input
                  id="address"
                  name="address"
                  type="text"
                  placeholder="Your Address"
                  class="address"
                  required
                />
              </div>

              <!-- Terms and Conditions Checkbox -->
              <div class="field terms-field">
                <div class="terms-checkbox-container">
                  <label class="terms-checkbox-label">
                    <input type="checkbox" id="terms-checkbox" name="terms-checkbox" required />
                    <span class="checkmark"></span>
                    <span class="terms-text">
                      I have read and agree to the 
                      <a href="../../tandc.html" target="_blank" class="terms-link">Terms and Conditions of Vehigo</a>
                    </span>
                  </label>
                </div>
              </div>

              <div class="field button-field">
                <button type="submit" id="signup-submit-btn">Signup</button>
              </div>
            </form>

            <div id="errorMessage"></div>

            <div class="form-link">
              <span
                >Already have an account ?
                <a href="#" class="link login-link">Login</a></span
              >
            </div>

            <div id="signinMessage"></div>
          </div>
        </div>
      </section>
    </div>

    <script>
  document.addEventListener("DOMContentLoaded", () => {
    const container = document.querySelector(".forms");
    const signUpLink = document.querySelector(".signup-link");
    const logInLink = document.querySelector(".login-link");
    const eyeIcons = document.querySelectorAll(".eye-icon");
    const signupForm = document.getElementById("signupForm");
    const loginForm = document.getElementById("loginForm");
    const signupErrorMessage = document.getElementById("errorMessage");
    const loginMessage = document.getElementById("loginMessage");
        // âœ… Password Checklist Validation
    const passwordInput = document.getElementById("signupPassword");
    const checklist = {
      length: document.getElementById("check-length"),
      uppercase: document.getElementById("check-uppercase"),
      lowercase: document.getElementById("check-lowercase"),
      number: document.getElementById("check-number"),
      special: document.getElementById("check-special"),
    };

    passwordInput.addEventListener("input", () => {
      const value = passwordInput.value;

      // Length check
      if (value.length >= 8) {
        checklist.length.classList.add("valid");
        checklist.length.classList.remove("invalid");
      } else {
        checklist.length.classList.add("invalid");
        checklist.length.classList.remove("valid");
      }

      // Uppercase check
      if (/[A-Z]/.test(value)) {
        checklist.uppercase.classList.add("valid");
        checklist.uppercase.classList.remove("invalid");
      } else {
        checklist.uppercase.classList.add("invalid");
        checklist.uppercase.classList.remove("valid");
      }
      if (/[a-z]/.test(value)) {
        checklist.lowercase.classList.add("valid");
        checklist.lowercase.classList.remove("invalid");
      } else {
        checklist.lowercase.classList.add("invalid");
        checklist.lowercase.classList.remove("valid");
      }
      // Number check
      if (/\d/.test(value)) {
        checklist.number.classList.add("valid");
        checklist.number.classList.remove("invalid");
      } else {
        checklist.number.classList.add("invalid");
        checklist.number.classList.remove("valid");
      }

      // Special char check
      if (/[!@#$%^&*]/.test(value)) {
        checklist.special.classList.add("valid");
        checklist.special.classList.remove("invalid");
      } else {
        checklist.special.classList.add("invalid");
        checklist.special.classList.remove("valid");
      }
    });

    // Show/Hide password functionality
    eyeIcons.forEach((eyeIcon) => {
      eyeIcon.addEventListener("click", () => {
        const passwordField = eyeIcon.previousElementSibling;
        if (passwordField.type === "password") {
          passwordField.type = "text";
          eyeIcon.classList.replace("bx-hide", "bx-show");
        } else {
          passwordField.type = "password";
          eyeIcon.classList.replace("bx-show", "bx-hide");
        }
      });
    });

    // Toggle between login and signup forms
    signUpLink.addEventListener("click", (e) => {
      e.preventDefault();
      container.classList.add("show-signup");
    });

    logInLink.addEventListener("click", (e) => {
      e.preventDefault();
      container.classList.remove("show-signup");
    });

    // Terms and Conditions Checkbox Validation
    const termsCheckbox = document.getElementById("terms-checkbox");
    const signupSubmitBtn = document.getElementById("signup-submit-btn");
    const termsContainer = document.querySelector(".terms-checkbox-container");
    
    // Initially disable submit button
    signupSubmitBtn.disabled = true;
    
    // Add error message element
    const termsErrorMessage = document.createElement("div");
    termsErrorMessage.className = "terms-error";
    termsErrorMessage.textContent = "You must agree to the Terms and Conditions to continue.";
    termsContainer.appendChild(termsErrorMessage);
    
    // Checkbox change event
    termsCheckbox.addEventListener("change", function() {
      if (this.checked) {
        signupSubmitBtn.disabled = false;
        termsContainer.classList.remove("error");
        termsErrorMessage.style.display = "none";
      } else {
        signupSubmitBtn.disabled = true;
        termsContainer.classList.add("error");
        termsErrorMessage.style.display = "block";
      }
    });

    // Handle Signup Form Submission
    if (signupForm) {
      signupForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        signupErrorMessage.textContent = "";

        // Check terms and conditions first
        if (!termsCheckbox.checked) {
          termsContainer.classList.add("error");
          termsErrorMessage.style.display = "block";
          termsCheckbox.focus();
          
          // Scroll to terms section
          termsContainer.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          
          return;
        }

        if (!signupForm.checkValidity()) {
          signupForm.reportValidity();
          return;
        }

        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("signupEmail").value.trim();
        const password = document.getElementById("signupPassword").value.trim();
        const confirmPassword = document.getElementById("confirmPassword").value.trim();
        const phone_number = document.getElementById("phone_number").value.trim();
        const address = document.getElementById("address").value.trim();

        if (!name || !email || !password || !phone_number || !address) {
          signupErrorMessage.textContent =
            "Please fill in all required fields.";
          return;
        }
        if (password !== confirmPassword) {
              signupErrorMessage.textContent = "Passwords do not match.";
              return;
        }
        try {
          const res = await fetch("http://localhost:4000/api/auth/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              name,
              email,
              password,
              phone_number,
              address,
              auth_provider: "email",
            }),
          });
          const result = await res.json();

          if (res.ok) {
            localStorage.setItem("userToken", result.token);
            localStorage.setItem("userInfo", JSON.stringify(result.user));
            window.location.href = `./about.html?message=Signup successful! Welcome to VehiGo!&type=success`;
          } else {
            signupErrorMessage.textContent =
              result.message || "Signup failed. Please try again.";
          }
        } catch (err) {
          console.error("Frontend error:", err);
          signupErrorMessage.textContent =
            "Error connecting to the server.";
        }
      });
    }

    // Handle Login Form Submission
    if (loginForm) {
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        loginMessage.textContent = "";

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();

        if (!email || !password) {
          loginMessage.textContent = "Please fill in all fields.";
          loginMessage.className = "error";
          return;
        }

        const spinner = document.getElementById("spinnerOverlay");
        spinner.style.display = "flex"; // Show spinner

        try {
          const res = await fetch("http://localhost:4000/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include",
            body: JSON.stringify({ email, password }),
          });

          const result = await res.json();

          if (res.ok && result.success) {
            localStorage.setItem("userToken", "logged-in");
            localStorage.setItem(
              "userInfo",
              JSON.stringify({
                username: result.user.username || result.user.email,
                email: result.user.email,
                id: result.user._id,
              })
            );

            window.location.href = `./about.html?message=${encodeURIComponent(
              result.message || "Login successful"
            )}&type=success`;
          } else {
            spinner.style.display = "none"; // Hide spinner on error
            loginMessage.textContent = result.message || "Invalid credentials";
            loginMessage.className = "error";
          }
        } catch (err) {
          spinner.style.display = "none"; // Hide spinner on error
          console.error("Frontend error:", err);
          loginMessage.textContent = "Login failed";
          loginMessage.className = "error";
        }
      });
    }

    // Logout function
    async function logout() {
      try {
        const res = await fetch("http://localhost:4000/api/auth/logout", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
        });
        if (res.ok) {
          localStorage.removeItem("userToken");
          localStorage.removeItem("userInfo");
          window.location.href = "./index.html";
        }
      } catch (err) {
        console.error("Logout error:", err);
      }
    }
  });
</script>

  </body>
</html>