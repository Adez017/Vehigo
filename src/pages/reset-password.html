<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reset Password - VehiGo</title>
  <link rel="stylesheet" href="../assets/styles/loginstyle.css">
</head>
<body>
  <div class="container forms">
    <div class="form">
      <div class="form-content">
        <header>Reset Password</header>
        <form id="resetPasswordForm">
          <input type="hidden" id="token" value="">
          <div class="field input-field">
            <input id="newPassword" type="password" placeholder="New Password" required>
          </div>
          <div class="field input-field">
            <input id="confirmPassword" type="password" placeholder="Confirm Password" required>
          </div>
          <div class="field button-field">
            <button type="submit">Reset Password</button>
          </div>
        </form>
        <div id="resetMessage"></div>
      </div>
    </div>
  </div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const token = params.get('token');
  document.getElementById('token').value = token || '';

  const form = document.getElementById('resetPasswordForm');
  const messageBox = document.getElementById('resetMessage');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const password = document.getElementById('newPassword').value.trim();
    const confirm = document.getElementById('confirmPassword').value.trim();

    if (password !== confirm) {
      messageBox.textContent = "Passwords do not match.";
      messageBox.className = "error";
      return;
    }
    if (password.length < 6 || password.length > 12) {
      messageBox.textContent = "Password must be 6 to 12 characters.";
      messageBox.className = "error";
      return;
    }

    try {
      const res = await fetch(`http://localhost:4000/api/auth/reset-password/${token}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password }),
      });
      const data = await res.json();
      if (res.ok) {
        messageBox.textContent = "Password updated successfully! Redirecting to login...";
        messageBox.className = "success";
        setTimeout(() => {
          window.location.href = "login.html";
        }, 2000);
      } else {
        messageBox.textContent = data.message || "Invalid or expired token.";
        messageBox.className = "error";
      }
    } catch {
      messageBox.textContent = "Server error. Please try again later.";
      messageBox.className = "error";
    }
  });
});
</script>

</body>
</html>
